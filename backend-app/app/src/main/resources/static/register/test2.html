<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form
      id="doctors-register-form"
      method="post"
      enctype="multipart/form-data"
    >
      <div>
        <!-- 이미지 미리보기를 위한 영역 -->
        <div
          id="preview-container"
          style="
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
          "
        >
          <img
            id="preview-img"
            src="../assets/img/default_profile.png"
            style="width: 100%; height: 100%"
          />
        </div>

        <!-- 파일 선택 버튼 -->
        <input
          type="file"
          id="file-input"
          accept="image/*"
          onchange="previewImage(event);"
        />
      </div>
      <input type="button" value="가입하기" id="btn-insert" />
    </form>
    <script>
      // 프로필 이미지
      function previewImage(event) {
        const input = event.target;
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const previewImg = document.querySelector('#preview-img');
            previewImg.src = e.target.result;
          };
          reader.readAsDataURL(input.files[0]);
          console.log(input.files[0]);
        } else {
          const previewImg = document.querySelector('#preview-img');
          previewImg.src = '../assets/img/default_profile.png'; // 기본 이미지 경로
        }
      }
      document.querySelector('#btn-insert').onclick = () => {
        const form = document.querySelector('#doctors-register-form');
        const formData = new FormData(form);

        const fileInput = document.querySelector('#file-input');

        if (fileInput.files && fileInput.files[0]) {
          formData.append('phoUrl', fileInput.files[0]);
          formData.append('phoName', fileInput.files[0].name);
          formData.append('phoType', fileInput.files[0].type);
        }

        console.log(formData);
        if (form.checkValidity()) {
          // let json = JSON.stringify(Object.fromEntries(formData));

          fetch('http://localhost:8080/doinsert', {
            method: 'POST',
            headers: {
              'Content-Type': 'multipart/form-data',
            },
            body: formData,
          })
            .then((response) => response.json())
            .then((result) => {
              if (result.status == 'success') {
                location.reload();
                console.log('성공:', data);
              } else {
                alert('입력실패');
                console.log(result.data);
              }
            })
            .catch((exception) => {
              alert('입력 중 오류 발생');
              console.log(exception);
              console.error('실패:', error);
            });
        } else {
          form.reportValidity();
        }
      };
    </script>
  </body>
</html>
