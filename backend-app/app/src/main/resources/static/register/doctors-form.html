<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form id="doctors-register-form" method="post">
      <label for="name">이름:</label>
      <input type="text" id="name" name="name" required /><br />
      <div>
        <label for="career">자격:</label>
        <select id="career" name="career" required>
          <option value="">선택하세요</option>
          <option value="MD">의사</option>
          <option value="DMD">치과의사</option>
          <option value="KMD">한의사</option>
        </select>
      </div>
      <div id="specialist-container" style="display: none">
        <label for="specialist">전문의 자격:</label>
        <select
          onchange="categoryChange(this)"
          id="specialist"
          required
        ></select>
      </div>
      <div>
        <form id="doctors-register-form"></form>
      <input type="button" value="가입하기" id="btn-insert" />
    </form>
    <!-- 사용자가 추가한 스크립트 -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
   <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
   <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
   <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script>
    const specialistContainer = document.querySelector(
        "#specialist-container"
      );
      const specialistSelect = document.querySelector("#specialist");
      const careerSelect = document.querySelector("#career");

      careerSelect.addEventListener("change", () => {
        const selectedCareer = careerSelect.value;
        const selectedSpecialist = specialistSelect.value;

        // 전문의 자격 select 보이도록 함
        if (selectedCareer !== "") {
          specialistContainer.style.display = "block";
        } else {
          specialistContainer.style.display = "none";
        }

        // 전문의 자격 select 옵션 설정
        if (selectedCareer === "MD") {
          specialistSelect.innerHTML = `
        <option value="">선택하세요</option>
        <option value="GP">General Practitioner, 일반의</option>
        <option value="FM">Family medicine, 가정의학과</option>
        <option value="TB">Tuberculosis, 결핵과</option>
        <option value="IM">Internal medicine, 내과</option>
        <option value="PED">Pediatrics, 소아청소년과</option>
        <option value="NR">Neurology, 신경과</option>
        <option value="NP">Psychiatry, 정신건강의학과</option>
        <option value="RM">Rehabilitation medicine, 재활의학과</option>
        <option value="DER">Dermatology, 피부과</option>
        <option value="UR">Urology, 비뇨의학과</option>
        <option value="OBGY">Obstetrics &amp; Gynecology, 산부인과</option>
        <option value="PS">Plastic surgery, 성형외과</option>
        <option value="NS">Neurosurgery, 신경외과</option>
        <option value="EY">Ophthalmology, 안과</option>
        <option value="GS">General surgery, 외과</option>
        <option value="ENT">Otolaryngology, 이비인후과</option>
        <option value="OS">Orthopaedic surgery, 정형외과</option>
        <option value="CS">Thoracic &amp; cardiovascular surgery, 흉부외과</option>
        <option value="AN">Anesthesiology, 마취통증의학과</option>
        <option value="RO">Radiation Oncology, 방사선종양학과</option>
        <option value="DR">Radiology, 영상의학과</option>
        <option value="EM">Emergency medicine, 응급의학과</option>
        <option value="OEM">Occupational &amp; Environmental medicine, 직업환경의학과</option>
        <option value="LM">Laboratory medicine, 진단검사의학과</option>
        <option value="NM">Nuclear medicine, 핵의학과</option>
        <option value="PM">Preventive medicine, 예방의학과</option>
        <option value="AP">Pathology, 병리과</option>
      `;
        } else if (selectedCareer === "DMD") {
          specialistSelect.innerHTML = `
        <option value="">선택하세요</option>
        <option value="GP">General Practitioner, 일반의</option>
        <option value="OMFS">Oral &amp; Maxillofacial Surgery, 구강악안면외과</option>
        <option value="PROS">Prosthodontics, 치과보철과</option>
        <option value="ORTH">Orthodontics, 치과교정과</option>
        <option value="PEDI">Pediatric Dentistry, 소아치과</option>
        <option value="PERI">Periodontology, 치주과</option>
        <option value="CONS">Conservative Dentistry, 치과보존과</option>
        <option value="OMED">Oral Medicine, 구강내과</option>
        <option value="AGD">Advaced General Dentistry, 통합치의학과</option>
        <option value="OMFR">Oral &amp; Maxillofacial Radiology, 영상치의학과</option>
        <option value="PATH">Oral &amp; Maxillofacial Pathology, 구강병리과</option>
        <option value="PREV">Preventive Dentistry, 예방치과</option>
      `;
        } else if (selectedCareer === "KMD") {
          specialistSelect.innerHTML = `
        <option value="">선택하세요</option>
        <option value="GP">General Practitioner, 일반의</option>
        <option value="KIM">Internal Korean Medicine, 한방내과</option>
        <option value="KOBGY">Korean Medicine Obstetrics &amp; Gynecology, 한방부인과</option>
        <option value="KPED">Korean Medicine Pediatrics, 한방소아과</option>
        <option value="KNS">Korean Neuropsychiatry, 한방 신경정신과</option>
        <option value="ACMOX">Acupuncture &amp; Moxibustion, 침구과</option>
        <option value="KEOD">Korean Medical Ophthalmology, Otolaryngology &amp; Dermatology, 한방안ㆍ이비인후ㆍ피부과</option>
        <option value="KRM">Korean Medicine Rehabilitation, 한방재활의학과</option>
        <option value="SCM">Sasang Constitutional Medicine, 사상체질과</option>
      `;
        }
      });
      specialistSelect.onchange = function () {
        selectedValue =
          specialistSelect.options[specialistSelect.selectedIndex].value;
        if (selectedValue !== "") {
          const licenseDetailFile = document.createElement("input");
          licenseDetailFile.type = "file";
          licenseDetailFile.id = "license-file";
          licenseDetailFile.name = "license-file";
          licenseDetailFile.multiple = true;
          // const licenseDetailInput = document.createElement("input");
          // licenseDetailInput.type = "text";
          // licenseDetailInput.id = "license-input";
          // licenseDetailInput.name = "license-input";
          // licenseDetailInput.className = "form-control";
          // licenseDetailInput.placeholder = "면허증번호";

          const form = document.getElementById("doctors-register-form");
          form.appendChild(licenseDetailFile);
          // form.appendChild(licenseDetailInput);
        }
      };
      document.querySelector("#btn-insert").onclick = () => {
        const form = document.querySelector("#doctors-register-form");
        const formData = new FormData(form);

        const selectedCareer = careerSelect.value;
        const selectedSpecialist = specialistSelect.value;

        formData.set("career", `${selectedCareer}: ${selectedSpecialist}`);        

        if (form.checkValidity()) {
        let json = JSON.stringify(Object.fromEntries(formData));

        fetch('http://localhost:8080/license/doinsert', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: json,
        })
          .then((response) => response.json())
          .then((result) => {
            if (result.status == 'success') {
              license(result.data);
              console.log('성공:', result.data);
            } else {
              alert('입력실패');
              console.log(result.data);
            }
          })
          .then(() => {
              location.reload();
          })
          .catch((exception) => {
            alert('입력 중 오류 발생');
            console.log(exception);
            console.error('실패:', error);
          });
      } else {
        form.reportValidity();
      }
    };
    function license(no) {
        let formData = new FormData();
        let files = document.querySelector("#license-file").files;
        if (files.length == 0) {
          return;
        }
        for (let i = 0; i < files.length; i++) {
          // if (
          //   files[i].name.includes(".bmp") ||
          //   files[i].name.includes(".jpeg") ||
          //   files[i].name.includes(".jpg") ||
          //   files[i].name.includes(".gif") ||
          //   files[i].name.includes(".png") ||
          //   files[i].name.includes(".tiff") ||
          //   files[i].name.includes(".psd") ||
          //   files[i].name.includes(".tga") ||
          //   files[i].name.includes(".ai") ||
          //   files[i].name.includes(".svg") ||
          //   files[i].name.includes(".exif") ||
          //   files[i].name.includes(".jfif")
          // ) {
            formData.append("files", files[i]);
            formData.append("licenseNo", no);
          // }
        }
        $.ajax({
          url: "http://localhost:8080/license/insertLicense",
          data: formData,
          cache: false,
          async: false,
          contentType: false,
          processData: false,
          type: "POST",
          success: function (data) {
            console.log("데이터 업로드 성공");
          },
          error: function (e) {
            console.log("데이터 업로드 실패");
          },
        });
      }
    </script>
  </body>
</html>
